var Page=function(){return{initAjaxBeforeShow:function($container){if($container==undefined){$container=$("body")}if($.fn.bootstrapSwitch){$(".make-switch:not(.has-switch)")["bootstrapSwitch"]()}if($.fn.multiSelect){$("select.multi-select-double",$container).each(function(){var $select=$(this);$select.multiSelect({selectableHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='快速过滤...'>",selectionHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='快速过滤...'>",afterInit:function(ms){var that=this;var $selectableSearch=that.$selectableUl.prev();var $selectionSearch=that.$selectionUl.prev();var selectableSearchString="#"+that.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)";var selectionSearchString="#"+that.$container.attr("id")+" .ms-elem-selection.ms-selected";that.qs1=$selectableSearch.quicksearch(selectableSearchString).on("keydown",function(e){if(e.which===40){that.$selectableUl.focus();return false}});that.qs2=$selectionSearch.quicksearch(selectionSearchString).on("keydown",function(e){if(e.which==40){that.$selectionUl.focus();return false}});var height=$select.attr("data-height");if(height){that.$container.find(".ms-list").css({height:height})}},afterSelect:function(){this.qs1.cache();this.qs2.cache()},afterDeselect:function(){this.qs1.cache();this.qs2.cache()}})})}if(jQuery().select2){$("select:not(.multi-select-double)",$container).each(function(){var $select2=$(this);if($select2.closest(".ui-search-input,.ui-pager-control").size()>0){return}if($select2.find(' > option[value=""]').size()==0){var $empty=$('<option value=""></option>');$select2.prepend($empty)}if($select2.find(" > option[selected]").size()==0){$select2.find("> option[value='']").attr("selected",true)}var allowClear=true;if($select2.attr("data-allowClear")){if($select2.attr("data-allowClear")=="false"){allowClear=false}}var placeholder=$select2.attr("placeholder");if(placeholder==undefined){placeholder="请选择..."}var options={placeholder:placeholder,allowClear:allowClear,matcher:function(term,text){var mod=Pinyin.getCamelChars(text)+"";var tf1=mod.toUpperCase().indexOf(term.toUpperCase())==0;var tf2=text.toUpperCase().indexOf(term.toUpperCase())==0;return(tf1||tf2)}};if($select2.attr("data-select2-type")=="combobox"){var $input=$('<input type="text" name="'+$(this).attr("name")+'"/>').insertAfter($select2);if($select2.attr("class")!=undefined){$input.attr("class",$select2.attr("class"))}var selected=$select2.find("option:selected").val();options=$.extend({},options,{placeholder:"请选择或输入...",allowClear:true,query:function(query){var data={results:[]};$select2.find("option").each(function(){data.results.push({id:$(this).val(),text:$(this).text()})});query.callback(data)},initSelection:function(element,callback){if(selected!=undefined){var data={id:selected,text:selected};callback(data)}},createSearchChoice:function(term,data){if($(data).filter(function(){return this.text.localeCompare(term)===0}).length===0){return{id:term,text:term}}}});$input.select2(options);if(selected!=undefined){$input.select2("val",[selected])}$select2.remove()}else{var dataCache=$select2.attr("data-cache");if(dataCache){var dataCache=eval(dataCache);for(var i in dataCache){$select2.append("<option value='"+i+"'>"+dataCache[i]+"</option>")}}var dataUrl=$select2.attr("data-url");if(dataUrl){var val=$select2.val();var dataCache=Util.getCacheSelectOptionDatas(WEB_ROOT+dataUrl);for(var i in dataCache){if(val&&val==i){continue}$select2.append("<option value='"+i+"'>"+dataCache[i]+"</option>")}}$select2.select2(options)}var $container=$select2.parent(".controls").children(".select2-container");if(!$container.hasClass("form-control")){$container.addClass("form-control")}})}$("form.form-search-auto label.btn",$container).on("click",function(){var $form=$(this).closest("form.form-search-auto");setTimeout(function(){$form.submit()},100)});$("form.form-search-auto select",$container).on("change",function(){var $form=$(this).closest("form.form-search-auto");setTimeout(function(){$form.submit()},100)});if($.fn.datepicker){$("input[data-toggle='datepicker'],input[data-toggle='datetimepicker']",$container).each(function(){var $datapicker=$(this);if($datapicker.attr("readonly")||$datapicker.attr("disabled")){return}var timeInput=$datapicker.attr("data-toggle");$datapicker.wrap('<div class="input-icon right"></div>');$datapicker.before('<i class="fa fa-calendar"></i>');var format=$datapicker.attr("data-format");if("datetimepicker"==timeInput){$datapicker.datetimepicker({clearBtn:true,autoclose:true,todayBtn:true,language:"zh-CN",format:format?format:"yyyy-mm-dd hh:ii",minuteStep:10})}else{var minViewMode="days";if(format){if(format=="yyyy-mm"){minViewMode="months"}else{if(format=="yyyy"){minViewMode="years"}}}$datapicker.datepicker({clearBtn:true,autoclose:true,todayBtn:true,language:"zh-CN",format:format?format:"yyyy-mm-dd",minViewMode:minViewMode})}$("body").removeClass("modal-open")})}$("input[data-daterangepicker]",$container).each(function(){var $daterangepicker=$(this);$daterangepicker.daterangepicker(options,function(start,end){$daterangepicker.focus();var $form=$daterangepicker.closest("form.form-search-auto");if($form.size()>0){$form.submit()}});$daterangepicker.off("focus")});$("table.table-sorting",$container).each(function(){var $sortingTable=$(this);var $container=$sortingTable.closest(".ajax-get-container");var url=$container.attr("data-url");var sortName=Util.getParameterFromUrl(url,"sidx");if(sortName&&sortName!=""){var $highlightTh=$sortingTable.find("th[data-sorting-name='"+sortName+"']");var sortDirection=Util.getParameterFromUrl(url,"sord");if(sortDirection=="asc"){$highlightTh.removeClass("sorting");$highlightTh.addClass("sorting_asc")}else{if(sortDirection=="desc"){$highlightTh.removeClass("sorting");$highlightTh.addClass("sorting_desc")}else{}}}$sortingTable.on("click","th[data-sorting-name]",function(){var $th=$(this);var $container=$sortingTable.find("> tbody.ajax-get-container");if($container.size()==0){$container=$sortingTable.closest(".ajax-get-container")}var url=$container.attr("data-url");var desc=false;if($th.hasClass("sorting")){$th.removeClass("sorting");$th.addClass("sorting_asc");desc="asc"}else{if($th.hasClass("sorting_asc")){$th.removeClass("sorting_asc");$th.addClass("sorting_desc");desc="desc"}else{$th.removeClass("sorting_desc");$th.addClass("sorting")}}url=Util.AddOrReplaceUrlParameter(url,"sidx",desc?$th.attr("data-sorting-name"):"");url=Util.AddOrReplaceUrlParameter(url,"sord",desc);$sortingTable.removeAttr("data-scroll-loading").removeAttr("data-scroll-page");$container.ajaxGetUrl(url)})});$(".control-label[data-tooltips]",$container).each(function(){var $el=$(this);var $tips=$('<span class="glyphicon glyphicon-exclamation-sign tooltipster" title="'+$el.attr("data-tooltips")+'"></span>').appendTo($el);var position="top";if($el.find("[data-rule-date]").length>0){position="right"}if($el.attr("data-tooltipster-position")){position=$el.attr("data-tooltipster-position")}$tips.tooltipster({contentAsHTML:true,offsetY:15,theme:"tooltipster-punk",position:position})});$("textarea[maxlength]",$container).maxlength({limitReachedClass:"label label-danger",alwaysShow:true});$('[data-toggle="dropdownselect"]',$container).each(function(){var $dropdown=$(this);var $clear=$('<i class="fa fa-times"></i>').insertBefore($dropdown);var $toggle=$('<i class="fa fa-angle-double-down btn-toggle"></i>').insertBefore($dropdown);var $elems=$dropdown.parent().children();$elems.wrapAll('<div class="input-icon right"></div>');$clear.click(function(){$elems.val("")});$dropdown.attr("autocomplete","off");var $parent=$dropdown.closest(".panel-content");var $container=$('<div class="container-dropdownselect container-callback" style="display : none;background-color: white;border: 1px solid #CCCCCC;"></div>');if($parent.size()>0){$container.appendTo($parent)}else{$container.appendTo($("body"))}if($dropdown.attr("data-minWidth")){$container.css("min-width",$dropdown.attr("data-minWidth"))}$dropdown.add($dropdown.parent().find("i.btn-toggle")).click(function(){var parentOffsetLeft=0;var parentOffsetTop=0;if($parent.size()>0){parentOffsetLeft=$parent.offset().left;parentOffsetTop=$parent.offset().top}var offset=$dropdown.offset();$container.css({width:$dropdown.outerWidth(),position:"absolute",left:(offset.left-parentOffsetLeft)+"px",top:(offset.top-parentOffsetTop)+$dropdown.outerHeight()+"px"});$container.data("callback",$dropdown.data("data-dropdownselect-callback"));$container.slideToggle("fast");var $btnToggle=$dropdown.parent().find("i.btn-toggle");if($btnToggle.hasClass("fa-angle-double-down")){$btnToggle.removeClass("fa-angle-double-down");$btnToggle.addClass("fa-angle-double-up")}else{$btnToggle.addClass("fa-angle-double-down");$btnToggle.removeClass("fa-angle-double-up")}if($container.is(":empty")){var url=$dropdown.attr("data-url");if($dropdown.attr("data-selected")){if(url.indexOf("?")>-1){url=url+"&selected="+$dropdown.attr("data-selected")}else{url=url+"?selected="+$dropdown.attr("data-selected")}}$container.ajaxGetUrl(url)}});$(document).on("mousedown",function(e){var $el=$dropdown.parent("div");if(!($el.is(e.target)||$el.find(e.target).length||$container.is(e.target)||$container.find(e.target).length)){$container.hide()}})});$("textarea[data-htmleditor='kindeditor']",$container).each(function(){var $kindeditor=$(this);var height=$kindeditor.attr("data-height");if(height==undefined){height="500px"}KindEditor.create($kindeditor,{allowFileManager:false,width:"100%",height:height,minWidth:"200px",minHeight:"60px",afterBlur:function(){this.sync()}})});$('.nav > li > a[href="#tab-auto"]',$container).each(function(){var $link=$(this);var $nav=$link.closest(".nav");var idx=$nav.find("li:not(.tools)").index($link.parent("li"));var $tabPane=$nav.parent().children(".tab-content").find("div.tab-pane").eq(idx);var tabid="tab-"+new Date().getTime()+idx;$tabPane.attr("id",tabid);$link.attr("href","#"+tabid)});$(".page-container .nav",$container).each(function(){var $nav=$(this);$nav.find("> li.active:first > a").click()});$("input.knob",$container).each(function(){$(this).knob({dynamicDraw:true,thickness:0.2,tickColorizeValues:true,skin:"tron",readOnly:true})})},initAjaxAfterShow:function($container){if($container==undefined){$container=$("body")}var $navTabs=$(".nav-tabs",$container);if($navTabs.size()>0){var active=null;var $actived=$navTabs.find("li:not(.tools):not(.dropdown).active");if($actived.size()>0){active=$navTabs.index("li:not(.tools):not(.dropdown).active")}if(active==null){var active=$navTabs.attr("data-active");if(active&&active!=""){active=Number(active)}else{active=0}}$navTabs.find("li:not(.tools):not(.dropdown):eq("+active+")").find("> a").click()}$("button:not([type])",$container).each(function(){$(this).attr("type","button")});$('.form-body .row[data-equal-height!="false"]',$container).each(function(){var maxHeight=0;var $rowcols=$(this).find(" > div > .form-group > div, > .form-group > div");$rowcols.each(function(){var height=$(this).innerHeight();if(height>maxHeight){maxHeight=height}});$rowcols.css("min-height",maxHeight)});jQuery("body").on("click","[data-reload]",function(e){var $btn=$(this);var target=$btn.attr("data-reload");if("container"==target){var $container=$btn.closest(".ajax-get-container");$container.ajaxGetUrl($container.attr("data-url"));return}else{if("location"==target){window.location.reload()}}})},doSomeStuff:function(){myFunc()}}}();