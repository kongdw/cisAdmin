var AdminGlobal=function(){var a;return{init:function(){if($.fn.editable){$.fn.editable.defaults.inputclass="form-control"}var c=$(window).height()-$("body > .header").height()-$("body > .footer").height()-15;$(".page-container > .page-content").css({"min-height":c+"px"});$(window).resize(function(){if($.fn.jqGrid){Grid.refreshWidth()}});$("#a-logout").click(function(){bootbox.confirm("确认注销登录吗？",function(h){if(h){window.location.href=WEB_ROOT+"/admin/logout"}})});$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(l){Util.debug(l.target+":"+l.type);var h=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var k=h.find("> .nav > li.active > a");var j=h.find(k.attr("href"));var i=k.attr("data-url");j.ajaxGetUrl(i)});var b=$(".page-sidebar-menu");if(b.size()>0){var g=function(l,n){var k=l.initOpen?"open":"";var m=l.active?"active":"";var i=l.url?WEB_ROOT+"/admin":"javascript:;";var o=n[n.length-1];var j=false;if(l.url){j=(Pinyin.getCamelChars(o)+"").toLowerCase()}var h='<li class="menu '+m+" "+k+'" data-path="'+l.path+'">';h+='<a href="javascript:;" '+(j?' data-py="'+j+'"':"")+(l.url?' rel="address:'+l.url+"|"+l.path+'"':"")+">";if(l.style){h+='<i class="fa '+l.style+'"></i>'}else{if(n.length==1){h+='<i class="fa fa-cogs"></i>'}else{if(l.url){h+='<i class="fa fa-dot-circle-o"></i>'}else{h+='<i class="fa fa-ellipsis-vertical"></i>'}}}if(n.length==1){h+='<span class="title">'+o+"</span>";h+='<span class="selected"></span>'}else{h+=o}if(!l.url){h+='<span class="arrow  '+k+'"></span></a></li>'}h+="</a></li>";return h};b.ajaxJsonUrl(WEB_ROOT+"/admin/menus",function(j){var h=undefined;var i=window.location.hash;if(i&&i!=""){i=i.replace("#","").split("|")[0];$.each(j,function(k,l){if(i==l.url){h=l.path;return false}})}$.each(j,function(n,o){if(Util.startWith(h,o.path)){o.initOpen=true;o.active=true}var p=o.path.split(":");if(p.length==1){b.append(g(o,p))}else{var m=[];$.each(p,function(s,r){if(s<p.length-1){m.push(r)}});var l=m.join(":");var q=b.find("li[data-path='"+l+"']");var k=q.find("> ul.sub-menu");if(k.size()==0){k=$('<ul class="sub-menu" style="display: '+(q.is(".open")?"block":"none")+';">').appendTo(q)}k.append(g(o,p))}})});$.address.change(function(j){App.scrollTop();if(j.value=="/"||j.value=="/dashboard"){AdminGlobal.addOrActivePanel("/admin/dashboard|Dashboard")}else{if(j.value=="/lock"){$.backstretch(["assets/img/bg/1.jpg","assets/img/bg/2.jpg","assets/img/bg/3.jpg","assets/img/bg/4.jpg"],{fade:1000,duration:8000});$(".page-container,.header,.footer").hide();$("#form-unlock").find(":text").focus().val("");$("#page-lock").show();$("#form-unlock").find("input").first().focus();$("body").ajaxPostURL({url:WEB_ROOT+"/layout!lock",confirmMsg:false})}else{var k=$('.page-sidebar li.menu > a[rel^="address:'+j.value+'"]');if(k.size()>0){AdminGlobal.addOrActivePanel(k.attr("rel").replace("address:",""));var m=$(".page-sidebar-menu").find("li");m.removeClass("active").removeClass("open");var l=k.parent("li");l.addClass("active");var h=l.closest("ul.sub-menu");while(h.size()>0){h.show();var i=h.parent("li");i.addClass("open");i.addClass("active");i.find(" > a > span.arrow").addClass("open");h=i.closest("ul.sub-menu")}}else{AdminGlobal.addOrActivePanel(j.value)}}}});$('.sidebar-search input[name="search"]').autocomplete({autoFocus:true,source:function(j,h){var i=b.find("a[data-py]");return h(i.map(function(){var n=j.term.toLowerCase();var k=$(this);var m=k.text();var l=k.attr("data-py");if(l.indexOf(n)>-1||m.indexOf(n)>-1){return{label:$.trim(m),link:k,href:k.attr("href")}}}))},minLength:1,select:function(i,j){var h=j.item;$(this).parent().find(".submit").data("link",h.link);h.link.click();return true}}).focus(function(){$(this).select()}).val("").focus();$('.sidebar-search input[name="search"]').parent().find(".submit").click(function(){var h=$(this).data("link");if(h){h.click()}return false})}var f=$("#header_notification_bar .badge");if(f.size()>0){$.ajax({dataType:"json",method:"get",url:WEB_ROOT+"/admin/profile/notify-message-count",success:function(h){var j=h.userdata;if(j>0){$("#messageInfo").html("<a href='javascripts:;' rel='address:/admin/profile/notify-message?toRead=1|未读消息列表'>您有 "+j+" 条未读消息</a>");f.html(j).show()}else{$("#messageInfo").html("<a href='javascripts:;' rel='address:/admin/profile/notify-message|消息列表'>暂无未读消息，点击查看消息列表</a>");f.html(0).hide()}}})}$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(l){Util.debug(l.target+":"+l.type);var h=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var k=h.find("> .nav > li.active > a");var j=h.find(k.attr("href"));var i=k.attr("data-url");j.ajaxGetUrl(i)});jQuery("body").on("click","#layout-nav >  li > .btn-close-active",function(k){var j=$("#layout-nav");var i=j.next(".tab-content").find(".panel-content:visible").attr("data-url");var h=j.find(" > .btn-group > ul.dropdown-menu");h.find("a[href='"+i+"']").find(".badge").click()});jQuery("body").on("click","ul.nav > li.tools > .reload",function(l){Util.debug(l.target+":"+l.type);l.preventDefault();var h=$(this).closest(".nav");var k=h.find("li.active > a");var j=h.closest(".tabbable").find(k.attr("href"));if(k.attr("data-url")){var i=k.attr("data-url");j.ajaxGetUrl(i,function(){j.find(".tabbable:first > .nav > li.active > a").click()})}else{if(jQuery().jqGrid){j.find("table.ui-jqgrid-btable").each(function(){var m=$(this);m.trigger("clearToolbar");var n=m.attr("data-url");m.jqGrid("setGridParam",{datatype:"json",url:n}).trigger("reloadGrid")})}}});$(".page-sidebar, .header").on("click",".sidebar-toggler",function(h){Grid.refreshWidth()});if($.fn.fileupload){$("#fileupload").fileupload({autoUpload:false,dataType:"json",url:WEB_ROOT+"/sys/attachment-file!uploadMulti"});var e=$("#fileupload");var d=null;jQuery("body").on("click","a.btn-fileinput-trigger",function(i){d=$(this);var h=d.attr("data-category");if(h){e.find("input[name='attachmentName']").val("_attachment_"+h)}e.find("tbody.files").empty()});jQuery("#fileupload-dialog").on("click",".modal-footer .btn-add",function(j){var i=d.parent().find("table.table-filelist");if(i.size()==0){i=$('<table role="presentation" class="table table-striped table-filelist clearfix"><tbody class="files"></tbody></table>').insertAfter(d)}var h=i.find("tbody.files");$("#fileupload").find("tbody.files tr.template-download").each(function(){h.append($(this).clone(true))});$("#fileupload-dialog").find('.modal-footer [data-dismiss="modal"]').click()})}jQuery("body").on("click",'a[data-toggle="panel"],button[data-toggle="panel"]',function(i){Util.debug(i.target+":"+i.type);i.preventDefault();var h=$(this);AdminGlobal.addOrActivePanel(h)});jQuery("body").on("click","tbody.select-table-checkbox",function(i){var h=$(this).find(".table-checkbox :checkbox");if(!(h.is(i.target)||h.find(i.target).length)){h.attr("checked",!h.is(":checked"))}})},findUserProfileParams:function(b){if(a==undefined||a==null){a=$("body").cacheData(WEB_ROOT+"/profile/simple-param-val!params.json")}return a[b]},setUserProfileParams:function(b,c){if(a==undefined||a==null){a=$("body").cacheData(WEB_ROOT+"/profile/simple-param-val!params.json")}a[b]=c},addOrActivePanel:function(l,m){l=decodeURI(l);var b=l;var j=l.split("|");if(j.length>1){b=j[0];if(m==undefined){m=j[1]}}b=WEB_ROOT+b;var h=m.split(":");var d=h[h.length-1];var m='<li><a href="#dashboard" class="btn-dashboard"><i class="fa fa-home"></i> 首页 </a></li> ';var f=$("#layout-nav");f.find("> li:not(.btn-group)").remove();$.each(h,function(o,n){n=n;if(o<h.length-1){m+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> '+n+" </li>"}else{m+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> <a class="reload" href="javascript:;">'+n+"</a> </li>"}});f.append(m);var e=f.next(".tab-content");var k=e.find("> div[data-url='"+b+"']");if(k.length==0){k=$('<div data-url="'+b+'" class="panel-content"></div>').appendTo(e);k.ajaxGetUrl(b)}else{k.show()}e.find("> div").not(k).hide();var c=f.find(" > .btn-group > ul.dropdown-menu");var g=c.find("> li > a[rel='address:"+l+"']");if(g.length==0){g=$('<a href="javascripts:;" rel="address:'+l+'">'+d+'<span class="badge badge-default">X</span></a>').appendTo(c).wrap("<li/>");g.find(".badge").click(function(p){p.preventDefault();p.stopPropagation();var o=false;k.find("form[method='post']:not(.form-track-disabled)[form-data-modified='true']").each(function(){var r=$(this);if(!confirm("当前表单有修改数据未保存，确认离开当前表单吗？")){o=true;return false}});if(!o){g.parent("li").remove();k.remove();var n=1;c.find("> li").not(g).each(function(){var r=$(this).attr("count");if(r){if(Number(r)>n){n=Number(r)}}});var q=c.find("> li[count='"+n+"'] > a");if(q.length>0){q.click()}else{$("#layout-nav >  li > .btn-dashboard").click()}}})}var i=1;c.find("> li").each(function(){$(this).removeClass("active");var n=$(this).attr("count");if(n){if(Number(n)>i){i=Number(n)}}});g.parent("li").addClass("active");g.parent("li").attr("count",i+1);f.find("> li:not(.btn-group) > a.reload").click(function(n){n.preventDefault();k.ajaxGetUrl(b)})}}}();